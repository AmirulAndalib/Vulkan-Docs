// Copyright (c) 2020-2025 Huawei Technologies Co. Ltd.
//
// SPDX-License-Identifier: CC-BY-4.0

[[external-memory-on-OHOS]]
=== Use External Memory On Open Harmony OS platform

ifdef::VK_OHOS_external_memory[]
[open,refpage='VkExternalFormatOHOS',desc='Structure containing an Open Harmony OS hardware buffer external format',type='structs']
--
:refpage: VkExternalFormatOHOS

The sname:VkExternalFormatOHOS structure is defined as:

include::{generated}/api/structs/VkExternalFormatOHOS.adoc[]

  * pname:sType is a elink:VkStructureType value identifying this structure.
  * pname:pNext is `NULL` or a pointer to a structure extending this
    structure.
  * pname:externalFormat is an implementation-defined identifier for the
    external format.

To obtain additional format that are not provided by ename:VkFormat for an
Open Harmony OS hardware buffer, this structure should be included in the
pNext chain of another structure.
The return value of pname:externalFormat indicates whether an additional
format eists.
If zero is returned, then no external format is used and other format
information should be used for implementations, and this is also true if
this structure is not present.
include::{generated}/validity/structs/VkExternalFormatOHOS.adoc[]
--

[open,refpage='VkImportNativeBufferInfoOHOS',desc='Import memory from an Open Harmony OS hardware buffer',type='structs']
--
To import memory created outside of the current Vulkan instance from an Open
Harmony OS native buffer, add a sname:VkImportNativeBufferInfoOHOS structure
to the pname:pNext chain of the slink:VkMemoryAllocateInfo structure.
The sname:VkImportNativeBufferInfoOHOS structure is defined as:

include::{generated}/api/structs/VkImportNativeBufferInfoOHOS.adoc[]

  * pname:sType is a elink:VkStructureType value identifying this structure.
  * pname:pNext is `NULL` or a pointer to a structure extending this
    structure.
  * pname:buffer is a pointer to an basetype:OH_NativeBuffer structure.

A reference to the imported native buffer should be acquired by the
implementation if the flink:vkAllocateMemory command succeeds.
Then the reference must: release when the device memory object is freed.
If the command fails, the implementation must: not retain a reference.
include::{generated}/validity/structs/VkImportNativeBufferInfoOHOS.adoc[]
--

[open,refpage='OH_NativeBuffer',desc='Native buffer on Open Harmony OS platform',type='basetypes']
--
The basetype:OH_NativeBuffer structure is defined as:

include::{generated}/api/basetypes/OH_NativeBuffer.adoc[]

It is the native buffer structure on Open Harmony OS platform.
It is defined in Open Harmony OS NDK headers.
--

[open,refpage='VkNativeBufferUsageOHOS',desc='The usage list of the OH_NativeBuffer object',type='structs']
--
To obtain optimal Open Harmony OS native buffer usage flags for specific
image creation parameters, add a sname:VkNativeBufferUsageOHOS structure to
the pname:pNext chain of a slink:VkImageFormatProperties2 structure passed
to flink:vkGetPhysicalDeviceImageFormatProperties2.

The sname:VkNativeBufferUsageOHOS structure is defined as:

include::{generated}/api/structs/VkNativeBufferUsageOHOS.adoc[]

  * pname:sType is a elink:VkStructureType value identifying this structure.
  * pname:pNext is `NULL` or a pointer to a structure extending this
    structure.
  * pname:OHOSNativeBufferUsage returns the Open Harmony OS buffer usage
    flags.

include::{generated}/validity/structs/VkNativeBufferUsageOHOS.adoc[]
--

[open,refpage='vkGetNativeBufferPropertiesOHOS',desc='Obtain the properties of an OH_NativeBuffer Object',type='protos']
--
To determine the memory parameters to use when importing an Open Harmony OS
native buffer:
include::{generated}/api/protos/vkGetNativeBufferPropertiesOHOS.adoc[]

  * pname:device is the logical device that will be importing pname:buffer.
  * pname:buffer is the basetype:OH_NativeBuffer object specifies the buffer
    for which its properties are to be queried.
  * pname:pProperties is a pointer to a slink:VkNativeBufferPropertiesOHOS
    structure in which the properties of pname:buffer are returned.

include::{generated}/validity/protos/vkGetNativeBufferPropertiesOHOS.adoc[]
--

[open,refpage='vkGetMemoryNativeBufferOHOS',desc='Obtain an OH_NativeBuffer object',type='protos']
--
:refpage: vkGetMemoryNativeBufferOHOS

To obtain an OH_NativeBuffer object, call:
include::{generated}/api/protos/vkGetMemoryNativeBufferOHOS.adoc[]

  * pname:device is a valid Vulkan device object.
  * pname:pInfo is a pointer pointing to a
    sname:VkMemoryGetNativeBufferInfoOHOS structure.
  * pname:pBuffer is a pointer to an basetype:OH_NativeBuffer object.

include::{generated}/validity/protos/vkGetMemoryNativeBufferOHOS.adoc[]

--

[open,refpage='VkNativeBufferPropertiesOHOS',desc='Properties of external memory Open Harmony OS native buffer',type='structs']
--
:refpage: VkNativeBufferPropertiesOHOS

The sname:VkNativeBufferPropertiesOHOS structure is defined as:

include::{generated}/api/structs/VkNativeBufferPropertiesOHOS.adoc[]

  * pname:sType is a elink:VkStructureType value identifying this structure.
  * pname:pNext is `NULL` or a pointer to a structure extending this
    structure.
  * pname:allocationSize is the size of the external memory.
  * pname:memoryTypeBits is a bitmask containing one bit set for every
    memory type which the specified Open Harmony OS native buffer can: be
    imported as.

include::{generated}/validity/structs/VkNativeBufferPropertiesOHOS.adoc[]

--

[open,refpage='VkNativeBufferFormatPropertiesOHOS',desc='Structure describing the image format properties of an Open Harmony OS native buffer',type='structs']
--
To obtain format properties of an Open Harmony OS native buffer, include a
sname:VkNativeBufferFormatPropertiesOHOS structure in the pname:pNext chain
of the slink:VkNativeBufferPropertiesOHOS structure passed to
flink:vkGetNativeBufferPropertiesOHOS.
The sname:VkNativeBufferFormatPropertiesOHOS structure is defined as:

include::{generated}/api/structs/VkNativeBufferFormatPropertiesOHOS.adoc[]

  * pname:sType is a elink:VkStructureType value identifying this structure.
  * pname:pNext is `NULL` or a pointer to a structure extending this
    structure.
  * pname:format is the Vulkan format corresponding to the Open Harmony OS
    native buffer's format, or ename:VK_FORMAT_UNDEFINED if there is not an
    equivalent Vulkan format.
  * pname:externalFormat is an implementation-defined external format
    identifier for use with slink:VkExternalFormatOHOS.
  * pname:formatFeatures describes the capabilities of this external format
    when used with an image bound to memory imported from pname:buffer.
  * pname:samplerYcbcrConversionComponents represents a set of
    elink:VkComponentSwizzle.
  * pname:suggestedYcbcrModel represents the color model.
  * pname:suggestedYcbcrRange represents the numerical value range.
  * pname:suggestedXChromaOffset represents the X chroma offset.
  * pname:suggestedYChromaOffset represents the Y chroma offset.

include::{generated}/validity/structs/VkNativeBufferFormatPropertiesOHOS.adoc[]

--

[open,refpage='VkMemoryGetNativeBufferInfoOHOS',desc='Structure describing an Open Harmony OS native buffer memory export operation',type='structs']
--

The sname:VkMemoryGetNativeBufferInfoOHOS structure is defined as:

include::{generated}/api/structs/VkMemoryGetNativeBufferInfoOHOS.adoc[]

  * pname:sType is a elink:VkStructureType value identifying this structure.
  * pname:pNext is `NULL` or a pointer to a structure extending this
    structure.
  * pname:memory is a valid sname:VkDeviceMemory object from which the Open
    Harmony OS native buffer will be exported.

include::{generated}/validity/structs/VkMemoryGetNativeBufferInfoOHOS.adoc[]

--
endif::VK_OHOS_external_memory[]
