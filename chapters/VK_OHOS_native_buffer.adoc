// Copyright (c) 2020-2025 Huawei Technologies Co. Ltd.
//
// SPDX-License-Identifier: CC-BY-4.0

[[resources-OHOS-native-buffer]]
=== Open Harmony OS Platform Native Buffer Usage

ifdef::VK_OHOS_native_buffer[]
[open,refpage='vkGetSwapchainGrallocUsageOHOS',desc='Obtain the proper Gralloc usage flag according to the given Vulkan device, image format and image usage flag',type='protos']
--
:refpage: vkGetSwapchainGrallocUsageOHOS

To obtain the Gralloc usage flag of a swapchain, call:
include::{generated}/api/protos/vkGetSwapchainGrallocUsageOHOS.adoc[]

  * pname:device is a valid sname:VkDevice object used to create the
    swapchain image.
  * pname:format is a elink:VkFormat value specifying the format of the
    given image.
  * pname:grallocUsage is a bitmask for setting a mask of zero or more
    `OH_NativeBuffer_Usage`, which is defined in the C APIs references
    documentation of Open Harmony OS Graphics Module.

include::{generated}/validity/protos/vkGetSwapchainGrallocUsageOHOS.adoc[]
--

[open,refpage='vkAcquireImageOHOS',desc='Obtain the ownership of a swapchain image, and push the external Fence into the slink:VkSemaphore object and the slink:VkFence object',type='protos']
--
:refpage: vkAcquireImageOHOS

To obtain the ownership of a swapchain image, call:
include::{generated}/api/protos/vkAcquireImageOHOS.adoc[]

  * pname:device is a valid sname:VkDevice object used to create the
    swapchain image.
  * pname:image is the target image.
  * pname:nativeFenceFd is a file descriptor of the native fence.
  * pname:semaphore is dlink:VK_NULL_HANDLE or a slink:VkSemaphore that will
    be signaled when the nativeFenceFd is signaled.
  * pname:fence is dlink:VK_NULL_HANDLE or slink:VkFence that will be
    signaled when the nativeFenceFd is signaled.

include::{generated}/validity/protos/vkAcquireImageOHOS.adoc[]
--

[open,refpage='vkQueueSignalReleaseImageOHOS',desc='Inform the system hardware buffer that the image is released for further use',type='protos']
--
:refpage: vkQueueSignalReleaseImageOHOS

To obtain the ownership of a swapchain image, call:
include::{generated}/api/protos/vkQueueSignalReleaseImageOHOS.adoc[]

  * pname:queue is a handle of sname:VkQueue.
  * pname:waitSemaphoreCount is the number of semaphores to wait on.
  * pname:pWaitSemaphores is a pointer to an array of slink:VkSemaphore
    handles upon which to wait before signaling the native fence.
  * pname:images is a handle of the slink:VkImage to be released.
  * pname:pNativeFenceFd is a pointer to either a negative value or the file
    descriptor of a native fence.
    A negative value indicates that the processing workflow has been
    completed, and the calling party is not required to perform additional
    waiting before subsequent processes.
    Otherwise, a native fence will be created and be signaled when the image
    is ready for realse.

include::{generated}/validity/protos/vkQueueSignalReleaseImageOHOS.adoc[]
--

[open,refpage='VkNativeBufferOHOS',desc='Native buffer on Open Harmony OS platform', type='structs']
--
:refpage: VkNativeBufferOHOS

The sname:VkNativeBufferOHOS structure is defined as:
include::{generated}/api/structs/VkNativeBufferOHOS.adoc[]

  * pname:sType is a elink:VkStructureType value identifying this structure.
  * pname:pNext is `NULL` or a pointer to a structure extending this
    structure.
  * pname:handle is a pointer to an basetype:OHBufferHandle object.

basetype:OHBufferHandle is exposed by the Open Harmony OS NDK.

include::{generated}/validity/structs/VkNativeBufferOHOS.adoc[]
--

[open,refpage='VkSwapchainImageCreateInfoOHOS',desc='The parameters needed to create a swapchain image on Open Harmony OS platform', type='structs']
--
:refpage: VkSwapchainImageCreateInfoOHOS

The sname:VkSwapchainImageCreateInfoOHOS structure is defined as:
include::{generated}/api/structs/VkSwapchainImageCreateInfoOHOS.adoc[]

  * pname:sType is a elink:VkStructureType value identifying this structure.
  * pname:pNext is `NULL` or a pointer to a structure extending this
    structure.
  * pname:usage is a bitmask of elink:VkSwapchainImageUsageFlagBitsOHOS
    specifying the usage of swapchain image.

include::{generated}/validity/structs/VkSwapchainImageCreateInfoOHOS.adoc[]
--

[open,refpage='VkPhysicalDevicePresentationPropertiesOHOS',desc='The presentation properties of a physical device',type='structs']
--
:refpage: VkPhysicalDevicePresentationPropertiesOHOS

The sname:VkPhysicalDevicePresentationPropertiesOHOS structure is defined
as:
include::{generated}/api/structs/VkPhysicalDevicePresentationPropertiesOHOS.adoc[]

  * pname:sType is a elink:VkStructureType value identifying this structure.
  * pname:pNext is `NULL` or a pointer to a structure extending this
    structure.
  * pname:sharedImage will be set to ename:VK_TRUE if the driver can share
    the ownership of a image with the display system.

include::{generated}/validity/structs/VkPhysicalDevicePresentationPropertiesOHOS.adoc[]
--

[open,refpage='VkSwapchainImageUsageFlagBitsOHOS',desc='Bitmask specifying the usage of a swapchain image on Open Harmony OS platform',type='enums']
--
:refpage: VkSwapchainImageUsageFlagBitsOHOS

Bits which can: be set in slink:VkSwapchainImageCreateInfoOHOS::pname::usage
specifying the usage of swapchain image on Open Harmony OS platform are:

include::{generated}/api/enums/VkSwapchainImageUsageFlagBitsOHOS.adoc[]

  * ename:VK_SWAPCHAIN_IMAGE_USAGE_SHARED_BIT_OHOS specifies that
    slink:VkSwapchainImageCreateInfoOHOS is used for creating a swapchain
    image whose internal native buffer can be shared for access by other
    applications.
--

[open,refpage='VkSwapchainImageUsageFlagsOHOS',desc='Bitmask of VkSwapchainImageUsageFlagBitsOHOS',type='flags']
--
include::{generated}/api/flags/VkSwapchainImageUsageFlagsOHOS.adoc[]

tname:VkSwapchainImageUsageFlagsOHOS is a bitmask type for setting a mask of
zero or more elink:VkSwapchainImageUsageFlagBitsOHOS.
--

[open,refpage='OHBufferHandle',desc='Open Harmony OS platform buffer handle type',type='basetypes']
--
include::{generated}/api/basetypes/OHBufferHandle.adoc[]

The basetype:OHBufferHandle type is used for obtaining and transffering
information of buffer on Open Harmony OS platform.
It is defined in Open Harmony OS NDK headers.
--
endif::VK_OHOS_native_buffer[]
